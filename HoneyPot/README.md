# 🛡️ JZ Secure Shield - 轻量级主动防御蜜罐

这是一个基于 **Cloudflare Workers** 和 **KV 数据库** 构建的高级蜜罐系统。它不仅能记录攻击，还能通过黑名单机制实现自动化的**永久防御**。

## ✨ 核心特性

* **智能诱捕**：内置常见扫描路径（`/wp-admin`, `/.env`, `/git` 等），一旦触碰立即触发捕获逻辑。
* **永久封禁**：攻击者一旦被捕获，其 IP 将被存入 KV 黑名单，后续访问任何路径均直接返回 403 嘲讽页面。
* **实时报警**：集成 Telegram Bot API，攻击者的 IP、物理位置、UA 设备、尝试路径等信息秒级推送。
* **可视化控制台**：
* **暗黑黑客风界面**：提供基于 TailwindCSS 的管理面板。
* **攻击地理分布**：使用 Leaflet 地图实时展示全球攻击来源。
* **统计图表**：自动生成攻击来源国家/地区比例。
* **一键释放**：支持手动管理黑名单，可对误伤 IP 进行 [RELEASE] 操作。



## 🛠️ 部署指南

### 1. 准备 KV 存储

在 Cloudflare 控制台导航至 **KV**，创建一个命名空间，例如命名为 `HONEYPOT_STORAGE`。

### 2. 配置环境变量

在 Worker 的 **Settings -> Variables** 中配置以下变量：

* `HONEYPOT_KV`: 绑定到你创建的 KV 命名空间。
* `ADMIN_PASSWORD`: 管理后台的 Basic Auth 密码（用户名默认为 `admin`）。
* `TG_TOKEN` (可选): Telegram Bot 的 Token。
* `TG_CHAT_ID` (可选): 接收报警的 Telegram 群组或个人 ID。

### 3. 修改安全 UUID

为了隐藏管理后台，请修改代码顶部的 `SECRET_UUID`：

```javascript
const SECRET_UUID = "你的唯一随机字符串";

```

部署后，你的管理后台地址为：`https://你的域名/你的唯一随机字符串`。

---

## 📂 路由功能说明

| 路径 | 功能描述 | 访问权限 |
| --- | --- | --- |
| `/` | 模拟正常站点，显示 Secure Connection | 公开 |
| `/admin`, `/.env`... | **蜜罐触发点**，触碰即封禁 | 公开 |
| `/{UUID}` | **管理控制台**，查看攻击地图和列表 | Basic Auth |
| `/{UUID}/api/...` | 后台交互 API | Basic Auth |

---

## ☣️ 捕获逻辑与响应

1. **触发阶段**：当请求匹配到 `traps` 数组中的敏感路径时。
2. **记录阶段**：异步记录攻击者的经纬度、城市、IP、UA 到 KV。
3. **封禁阶段**：向 KV 写入一条 `block:IP` 记录。
4. **通知阶段**：发送 HTML 格式的 Telegram 警报，包含详细坐标。
5. **响应阶段**：向攻击者展示红色高警示性的“追踪中”页面。

## 🔧 自定义扩展

### 修改诱捕路径

在代码 `// --- 6. 蜜罐诱捕逻辑 ---` 处修改 `traps` 数组，增加你想要伪装的敏感路径。

### 修改嘲讽页面

修改 `generateTrollPage` 函数中的 HTML 代码，可以自定义显示给攻击者的警告信息。

---

## ⚠️ 安全警告

* 请务必保管好你的 `SECRET_UUID`，它是进入管理系统的唯一凭证。
* 建议定期清理 KV 中的旧日志以确保存储空间（虽然 KV 空间极大）。
